<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f19" />
  <title>Enerpad AC 行動電源使用時間試算</title>
  <style>
    :root{
      --bg:#0b0f19; --card:#121829; --muted:#9aa4b2; --accent:#3d8bff; --accent-hover:#2f78e6;
      --field:#1a2238; --stroke:#1f2a44; --warn:#ff5c5c; --text:#e6edf7; --highlight:#ffcc00;
    }
    body{font-family:Arial,system-ui,-apple-system,"Noto Sans TC",sans-serif;background:var(--bg);color:var(--text);display:flex;justify-content:center;align-items:flex-start;min-height:100vh;margin:0;padding:max(16px,env(safe-area-inset-top)) max(16px,env(safe-area-inset-right)) max(16px,env(safe-area-inset-bottom)) max(16px,env(safe-area-inset-left));box-sizing:border-box;font-size:16px;line-height:1.5}
    .container{background:var(--card);padding:24px;border-radius:16px;width:100%;max-width:clamp(340px,92vw,560px);box-shadow:0 6px 24px rgba(0,0,0,.55);border:1px solid var(--stroke);box-sizing:border-box}
    h2{text-align:center;margin:0 0 16px;color:var(--accent);font-size:clamp(20px,2.6vw,24px);line-height:1.35}
    label{display:block;margin:10px 0 6px;font-size:14px;white-space:normal;text-align:left}
    select,input[type=number],input[readonly]{width:100%;padding:12px;border-radius:12px;border:1px solid var(--stroke);background:var(--field);color:var(--text);margin-bottom:10px;font-size:16px;outline:none;box-sizing:border-box}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px;border:1px solid var(--stroke);background:#0f1729;color:#cfe0ff}
    .badge-ups{background:#4a1920;color:#ffd1d6;border-color:#7a2b38}
    .badge-pd{background:#102131;color:#b9f6ff;border-color:#2a4b6b}
    .badge-plane{background:#10281a;color:#b7ffbf;border-color:#2b5f3a}
    .spec-box{background:var(--field);padding:12px;border-radius:12px;border:1px solid var(--stroke);font-size:14px;margin-bottom:10px}
    .spec-box strong{color:var(--accent)}
    .actions{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    @media(min-width:480px){.actions{flex-direction:row}}
    button{flex:1;padding:12px;border:none;border-radius:12px;cursor:pointer;font-size:16px;box-sizing:border-box}
    .calculate{background:var(--accent);color:#fff;font-weight:700}
    .calculate:hover{background:var(--accent-hover)}
    .reset{background:#0f1729;color:#e6edf7;border:1px solid var(--stroke)}
    .reset:hover{background:#0d1422}
    .result{margin-top:14px;padding:14px;border-radius:12px;background:var(--field);text-align:left;border:1px solid var(--stroke);box-sizing:border-box;word-break:break-word}
    .result strong{color:var(--accent)}
    .highlight{font-weight:700;color:var(--highlight)}
    .limit{display:none;margin-top:6px;padding:10px;background:rgba(255,92,92,.12);color:#ffd5d5;border:1px solid rgba(255,92,92,.45);border-radius:12px;font-weight:700;text-align:left;box-sizing:border-box;word-break:break-word}
    details{margin-top:14px;background:var(--field);padding:12px;border-radius:12px;border:1px solid var(--stroke);box-sizing:border-box}
    summary{cursor:pointer;font-weight:700;color:var(--accent);display:flex;align-items:center}
    summary::before{content:'＋';margin-right:6px;transition:transform .2s}
    details[open] summary::before{content:'－'}
    summary:hover{color:var(--accent-hover)}
    .panel{overflow:hidden;max-height:0;transition:max-height 280ms ease}
  </style>
</head>
<body>
  <div class="container">
    <h2>Enerpad AC 行動電源<br/>使用時間試算</h2>

    <label for="model">選擇型號：</label>
    <select id="model">
      <option value="AC27KD">AC-27KD</option>
      <option value="AC40K">AC-40K</option>
      <option value="MD42K">MD-42K</option>
      <option value="UPS55K">UPS-55K</option>
      <option value="MD80K">MD-80K</option>
      <option value="AC160K">AC-160K</option>
    </select>

    <div id="specBox" class="spec-box">請選擇型號以查看規格</div>

    <label for="capacity">容量（Wh）</label>
    <input id="capacity" type="number" readonly />
    <div class="hint" style="font-size:12px;color:var(--muted);margin-top:-6px;">由型號自動帶入。</div>

    <label for="power">輸入預計使用的電器功率 (W)</label>
    <input type="number" id="power" placeholder="例如 65" inputmode="decimal" step="0.1" />

    <div id="limit" class="limit" aria-live="polite" role="alert"></div>

    <div class="actions">
      <button class="calculate" onclick="calculate()">請輸入數值並點擊計算</button>
      <button class="reset" onclick="resetForm()">重設</button>
    </div>

    <div class="result" id="result" aria-live="polite">請輸入數值進行計算</div>

    <p id="globalWarn" style="display:none;background:rgba(255,92,92,.15);color:#ff8080;padding:10px;border-radius:12px;border:1px solid rgba(255,92,92,.4);font-weight:700;text-align:left;"> 注意：此類高功率電器不適合搭配 Enerpad AC 行動電源。</p>

    <details class="accordion" id="mainGuide">
      <summary> 查看功率計算公式與說明</summary>
      <div class="panel">
        <p class="section-title" style="font-weight:bold;color:var(--accent);">計算公式：</p>
        <p><b>容量 (Wh) × 0.8 ÷ 功率 (W)</b></p>
        <p>為何乘 0.8？以預留逆變損耗與安全餘裕，做保守估算。</p>

        <p class="section-title" style="font-weight:bold;color:var(--accent);">如何換算功率 (W)：</p>
        <p><b>電壓 (V) × 電流 (A) = 功率 (W)</b></p>
        <ul>
          <li>例 1：20V × 3.25A = 65W（常見筆電充電器）</li>
          <li>例 2：12V × 1.5A ≈ 18W（路由器／小家電）</li>
          <li>例 3：部分電熱商品無標示瞬間最高功率，可用功率表做精準測試</li>
          <li>例 4：筆電通常標示效能全開時的最高功率，但一般使用時功率較低</li>
        </ul>

        <p class="section-title" style="font-weight:bold;color:var(--accent);">常見電器功率範例：</p>
        <details class="accordion">
          <summary>常見電器功率</summary>
          <div class="panel">
            <ul>
              <li>LED 燈泡：5W ~ 15W</li>
              <li>小冰箱（行動冰箱）：50W ~ 100W</li>
              <li>筆記型電腦：45W ~ 250W（依型號差異）</li>
              <li>電視機（32~50吋）：60W ~ 150W</li>
              <li>DC直流電扇：5W ~ 25W（較傳統電扇省電）</li>
              <li>陽壓呼吸器：75W ~ 200W</li>
            </ul>
          </div>
        </details>

        <p class="section-title" style="font-weight:bold;color:var(--accent);">注意事項：</p>
        <p>「連續使用負載」指的是行動電源可以長時間穩定輸出的最大功率。<br>有些電器會在啟動瞬間產生短暫峰值功率，可能高於連續使用負載，但時間極短，不等同於可長時間承載。</p>

        <p class="section-title" style="font-weight:bold;color:var(--accent);">高功率家電範例：</p>
        <details class="accordion" id="highPower">
          <summary>高功率家電</summary>
          <div class="panel">
            <ul>
              <li>吹風機：1000W ~ 1800W</li>
              <li>微波爐：800W ~ 1500W</li>
              <li>電磁爐：1200W ~ 2000W</li>
              <li>電熱水壺：1000W ~ 1500W</li>
            </ul>
            <p style="background:rgba(255,92,92,.15);color:#ff8080;padding:10px;border-radius:12px;border:1px solid rgba(255,92,92,.4);font-weight:700;"> 注意：此類高功率電器不適合搭配 Enerpad AC 行動電源。</p>
          </div>
        </details>

        <p class="hint" style="font-size:12px;color:var(--muted);">若只看到 mA，請先換算為 A（如 500mA = 0.5A）。</p>
      </div>
    </details>
  </div>

  <script>
    // 規格＋徽章條件
    const SPECS={
      AC27KD:{cap:91.6,max:100,name:"AC-27KD",plane:true},
      AC40K:{cap:144.7,max:100,name:"AC-40K",plane:true},
      MD42K:{cap:149.0,max:200,name:"MD-42K",pd:true,plane:true},
      UPS55K:{cap:198.7,max:200,name:"UPS-55K",ups:true},
      MD80K:{cap:298.0,max:200,name:"MD-80K",pd:true},
      AC160K:{cap:576.0,max:200,name:"AC-160K"}
    };

    // DOM 參照
    const modelSel=document.getElementById('model');
    const capacityInput=document.getElementById('capacity');
    const specBox=document.getElementById('specBox');
    const resultDiv=document.getElementById('result');
    const limitDiv=document.getElementById('limit');
    const powerInput=document.getElementById('power');
    const globalWarn=document.getElementById('globalWarn');

    function renderBadges(spec){
      let badges="";
      if(spec.ups)badges+=`<span class="badge badge-ups">UPS 不斷電</span>`;
      if(spec.pd)badges+=`<span class="badge badge-pd">PD 快充</span>`;
      if(spec.plane)badges+=`<span class="badge badge-plane">可上飛機</span>`;
      return badges;
    }

    function syncSpec(){
      const id=modelSel.value; const spec=SPECS[id];
      if(!spec){
        specBox.innerHTML='請選擇型號以查看規格';
        capacityInput.value='';
        return;
      }
      capacityInput.value=spec.cap;
      specBox.innerHTML=`<strong>${spec.name}</strong> ${renderBadges(spec)}<br/>容量：約 ${spec.cap} Wh<br/>連續使用負載：${spec.max} W`;
      // 清空提示
      limitDiv.style.display='none';
      resultDiv.textContent='請輸入數值進行計算';
      globalWarn.style.display='none';
    }

    function checkLimit(){
      const id=modelSel.value; const spec=SPECS[id];
      const w=parseFloat(powerInput.value);
      let over=false; let msg='';

      if(!isNaN(w)){
        globalWarn.style.display = w>200 ? 'block' : 'none';
        if((id==='AC27KD'||id==='AC40K') && w>100 && w<=200){
          over=true; msg=` 超過連續使用負載（本型號連續使用負載 ${spec.max}W）。建議選擇 MD-42K 以上型號。`;
        }else if(w>spec.max){
          over=true; msg=` 超過連續使用負載（本型號連續使用負載 ${spec.max}W）`;
        }
      }else{
        globalWarn.style.display='none';
      }

      limitDiv.style.display = over ? 'block' : 'none';
      if(over){ limitDiv.innerHTML = msg; }
      return over;
    }

    function calculate(){
      const id=modelSel.value; const spec=SPECS[id];
      if(!spec){ alert('請先選擇型號'); return; }
      const wh=spec.cap; const w=parseFloat(powerInput.value);
      if(isNaN(w)){ alert(' 請輸入數字！'); return; }
      if(checkLimit()) return; // 超載時不計算
      if(w<=0){ resultDiv.textContent=' 請輸入正確數值'; return; }

      const hours=(wh*0.8)/w; const hr=Math.floor(hours); const min=Math.round((hours-hr)*60);
      resultDiv.innerHTML=` 預估可使用時間：<strong>${hr} 小時 ${String(min).padStart(2,'0')} 分</strong><br/><span class="highlight">本型號連續使用負載：${spec.max}W</span>`;
    }

    function resetForm(){
      modelSel.selectedIndex=0; powerInput.value=''; syncSpec();
    }

    // 綁定事件 & 初始化
    modelSel.addEventListener('change', syncSpec);
    powerInput.addEventListener('input', checkLimit);
    document.addEventListener('DOMContentLoaded', syncSpec);
    // 直接呼叫一次以在載入時顯示第一個型號資訊
    syncSpec();

    // Accordion：平滑展開且不裁切 + 自動捲動避免遮擋 + 視窗/鍵盤變化重算高度
    (function setupAccordion(){
      const accordions=document.querySelectorAll('details.accordion');

      const adjustWhenOpen = (dtl, panel) => {
        if (!dtl.open) return;
        if (panel.style.maxHeight !== 'none') {
          panel.style.maxHeight = panel.scrollHeight + 'px';
        }
        const rect = panel.getBoundingClientRect();
        const overflow = rect.bottom - (window.innerHeight - 12);
        if (overflow > 0) {
          window.scrollBy({ top: overflow, left: 0, behavior: 'smooth' });
        }
      };

      accordions.forEach(dtl=>{
        const panel=dtl.querySelector('.panel');
        if(!panel) return;
        panel.style.maxHeight='0px';

        const onToggle=()=>{
          if(dtl.open){
            panel.style.maxHeight=panel.scrollHeight+'px';
            const onEnd=()=>{
              panel.style.maxHeight='none';
              panel.removeEventListener('transitionend', onEnd);
              adjustWhenOpen(dtl, panel);
            };
            panel.addEventListener('transitionend', onEnd);
          }else{
            if(panel.style.maxHeight==='none'){
              panel.style.maxHeight=panel.scrollHeight+'px';
              panel.getBoundingClientRect();
            }
            requestAnimationFrame(()=>{ panel.style.maxHeight='0px'; });
          }
        };

        if(dtl.open){ panel.style.maxHeight='none'; }
        dtl.addEventListener('toggle', onToggle);

        const recalc = ()=> adjustWhenOpen(dtl, panel);
        window.addEventListener('resize', recalc);
        window.addEventListener('orientationchange', recalc);
        if (window.visualViewport) {
          window.visualViewport.addEventListener('resize', recalc);
        }
      });
    })();
  </script>
</body>
</html>
